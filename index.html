<!DOCTYPE html>
<html lang="th">
<head>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link rel="icon" href="/api/placeholder/32/32" alt="logo">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Allquiz เว็บไซต์เฉลยคำตอบรายวิชาต่างๆ">
  <meta property="og:title" content="Allquiz - เฉลยคำตอบรายวิชา">
  <meta property="og:description" content="เว็บไซต์ Allquiz ที่ให้บริการเฉลยคำตอบในรายวิชาต่างๆ สำหรับนักศึกษาและผู้ที่ต้องการคำแนะนำในการศึกษา">
  <meta property="og:image" content="image/logo.png">
  <meta property="og:url" content="https://www.instagram.com/doralaikon_th/">
  <meta property="og:type" content="website">
  <title>Allquiz - Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    /* Base styles from the original template */
    :root {
      --primary-color: #7C4DFF;
      --secondary-color: #651FFF;
      --dark-color: #212121;
      --light-color: #F5F5F5;
      --accent-color: #FF4081;
      --success-color: #4CAF50;
      --warning-color: #FFC107;
      --danger-color: #FF5252;
      --info-color: #2196F3;
      --navbar-height: 70px;
      --card-radius: 16px;
      --button-radius: 30px;
      --element-spacing: 15px;
      --shadow-light: 0 5px 15px rgba(0, 0, 0, 0.05);
      --shadow-medium: 0 8px 20px rgba(0, 0, 0, 0.1);
      --shadow-dark: 0 12px 28px rgba(0, 0, 0, 0.15);
      --transition-speed: 0.3s;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      -webkit-user-select: none;
      user-select: none;
      font-family: 'Kanit', sans-serif;
      background-color: #f9f9f9;
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Include all the other styles from the original template */
    
    /* Add new styles for admin functionality */
    
    /* Admin Login Form */
    .admin-login-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1100;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .admin-login-container {
      background: white;
      border-radius: var(--card-radius);
      width: 90%;
      max-width: 400px;
      box-shadow: var(--shadow-dark);
      overflow: hidden;
      animation: slideUp 0.5s ease-out;
    }
    
    .admin-login-header {
      background: linear-gradient(90deg, var(--dark-color), #424242);
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    
    .admin-login-header h2 {
      font-size: 1.5rem;
      margin: 0;
    }
    
    .admin-login-content {
      padding: 20px;
    }
    
    .admin-login-form .form-group {
      margin-bottom: 15px;
    }
    
    .admin-login-form label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--dark-color);
    }
    
    .admin-login-form input {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: var(--button-radius);
      font-family: 'Kanit', sans-serif;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    
    .admin-login-form input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(124, 77, 255, 0.2);
    }
    
    .admin-login-form .admin-login-button {
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      border-radius: var(--button-radius);
      padding: 12px 25px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      margin-top: 10px;
      box-shadow: 0 4px 10px rgba(124, 77, 255, 0.25);
    }
    
    .admin-login-form .admin-login-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(124, 77, 255, 0.35);
    }
    
    .admin-login-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .admin-login-close:hover {
      color: var(--danger-color);
      transform: scale(1.1);
    }
    
    .login-error {
      color: var(--danger-color);
      font-size: 0.9rem;
      margin-top: 15px;
      text-align: center;
      display: none;
    }
    
    /* Admin Panel */
    .admin-panel {
      display: none;
      background: white;
      border-radius: var(--card-radius);
      margin: 20px auto;
      max-width: 1200px;
      box-shadow: var(--shadow-medium);
      overflow: hidden;
    }
    
    .admin-header {
      background: linear-gradient(90deg, var(--dark-color), #424242);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .admin-header h2 {
      font-size: 1.5rem;
      margin: 0;
    }
    
    .admin-controls {
      display: flex;
      gap: 10px;
    }
    
    .admin-button {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      border-radius: var(--button-radius);
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .admin-button:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .admin-button.danger {
      background: rgba(255, 82, 82, 0.8);
    }
    
    .admin-button.danger:hover {
      background: rgba(255, 82, 82, 1);
    }
    
    .admin-content {
      padding: 20px;
    }
    
    /* Subject selection for admin */
    .admin-subject-selector {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    
    .admin-subject-card {
      background: white;
      border: 1px solid #eee;
      border-radius: var(--card-radius);
      padding: 15px;
      flex: 1;
      min-width: 200px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-light);
    }
    
    .admin-subject-card:hover {
      border-color: var(--primary-color);
      transform: translateY(-3px);
      box-shadow: var(--shadow-medium);
    }
    
    .admin-subject-card.active {
      background: linear-gradient(to right, rgba(124, 77, 255, 0.1), rgba(101, 31, 255, 0.1));
      border-color: var(--primary-color);
    }
    
    .admin-subject-card i {
      font-size: 2rem;
      color: var(--primary-color);
      margin-bottom: 10px;
    }
    
    .admin-subject-card h4 {
      margin: 0;
      font-size: 1.1rem;
    }
    
    /* Quiz editor */
    .quiz-editor {
      display: none;
      margin-top: 20px;
    }
    
    .quiz-editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    
    .quiz-editor-header h3 {
      font-size: 1.3rem;
      margin: 0;
      color: var(--dark-color);
    }
    
    .quiz-editor-actions {
      display: flex;
      gap: 10px;
    }
    
    .quiz-editor-button {
      padding: 8px 16px;
      border-radius: var(--button-radius);
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      border: none;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.3s ease;
    }
    
    .quiz-editor-button.add {
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      color: white;
      box-shadow: 0 3px 8px rgba(124, 77, 255, 0.25);
    }
    
    .quiz-editor-button.add:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(124, 77, 255, 0.35);
    }
    
    /* Quiz table */
    .quiz-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    
    .quiz-table th {
      background: #f5f5f5;
      padding: 12px 15px;
      text-align: left;
      font-weight: 500;
      color: #555;
      border-bottom: 2px solid #eee;
    }
    
    .quiz-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
      vertical-align: middle;
    }
    
    .quiz-table tr:hover {
      background-color: rgba(124, 77, 255, 0.05);
    }
    
    .quiz-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    
    .quiz-action-button {
      background: none;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .quiz-action-button.edit {
      color: var(--info-color);
      background: rgba(33, 150, 243, 0.1);
    }
    
    .quiz-action-button.edit:hover {
      background: rgba(33, 150, 243, 0.2);
    }
    
    .quiz-action-button.delete {
      color: var(--danger-color);
      background: rgba(255, 82, 82, 0.1);
    }
    
    .quiz-action-button.delete:hover {
      background: rgba(255, 82, 82, 0.2);
    }
    
    /* Modal for quiz editing and adding */
    .quiz-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1200;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .quiz-modal-container {
      background: white;
      border-radius: var(--card-radius);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-dark);
      animation: slideUp 0.5s ease-out;
    }
    
    .quiz-modal-header {
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 15px 20px;
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .quiz-modal-header h3 {
      font-size: 1.3rem;
      margin: 0;
    }
    
    .quiz-modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
    }
    
    .quiz-modal-content {
      padding: 20px;
    }
    
    .quiz-form .form-group {
      margin-bottom: 15px;
    }
    
    .quiz-form label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--dark-color);
    }
    
    .quiz-form input,
    .quiz-form textarea,
    .quiz-form select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-family: 'Kanit', sans-serif;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    
    .quiz-form textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .quiz-form input:focus,
    .quiz-form textarea:focus,
    .quiz-form select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(124, 77, 255, 0.2);
    }
    
    .quiz-form .form-row {
      display: flex;
      gap: 15px;
    }
    
    .quiz-form .form-row .form-group {
      flex: 1;
    }
    
    .quiz-form .quiz-save-button {
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      border-radius: var(--button-radius);
      padding: 12px 25px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      margin-top: 10px;
      box-shadow: 0 4px 10px rgba(124, 77, 255, 0.25);
    }
    
    .quiz-form .quiz-save-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(124, 77, 255, 0.35);
    }
    
    /* Confirmation Modal */
    .confirm-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1300;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    .confirm-container {
      background: white;
      border-radius: var(--card-radius);
      width: 90%;
      max-width: 400px;
      box-shadow: var(--shadow-dark);
      animation: scaleIn 0.3s ease-out;
      overflow: hidden;
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    .confirm-header {
      background: var(--danger-color);
      color: white;
      padding: 15px 20px;
    }
    
    .confirm-header h3 {
      margin: 0;
      font-size: 1.2rem;
    }
    
    .confirm-content {
      padding: 20px;
      text-align: center;
    }
    
    .confirm-content p {
      margin-bottom: 20px;
      font-size: 1rem;
      color: #555;
    }
    
    .confirm-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    
    .confirm-button {
      padding: 10px 20px;
      border-radius: var(--button-radius);
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
    }
    
    .confirm-button.cancel {
      background: #eee;
      color: #555;
    }
    
    .confirm-button.cancel:hover {
      background: #ddd;
    }
    
    .confirm-button.confirm {
      background: var(--danger-color);
      color: white;
    }
    
    .confirm-button.confirm:hover {
      background: #ff1744;
    }
    
    /* Toast notifications */
    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1500;
    }
    
    .toast {
      min-width: 250px;
      margin-top: 10px;
      border-radius: var(--card-radius);
      padding: 15px 20px;
      display: flex;
      align-items: center;
      box-shadow: var(--shadow-medium);
      animation: slideInRight 0.5s, fadeOut 0.5s 2.5s forwards;
      position: relative;
      overflow: hidden;
    }
    
    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    .toast::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
    }
    
    .toast.success {
      background: #f1f8e9;
      color: var(--success-color);
    }
    
    .toast.success::before {
      background: var(--success-color);
    }
    
    .toast.error {
      background: #fdecea;
      color: var(--danger-color);
    }
    
    .toast.error::before {
      background: var(--danger-color);
    }
    
    .toast.info {
      background: #e3f2fd;
      color: var(--info-color);
    }
    
    .toast.info::before {
      background: var(--info-color);
    }
    
    .toast i {
      margin-right: 10px;
      font-size: 1.2rem;
    }
    
    /* Admin indicator on navbar */
    .admin-indicator {
      display: none;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.8rem;
      margin-left: 10px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    /* Status badges for quiz table */
    .status-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.8rem;
      text-align: center;
      min-width: 80px;
    }
    
    .status-badge.active {
      background-color: rgba(76, 175, 80, 0.1);
      color: var(--success-color);
      border: 1px solid rgba(76, 175, 80, 0.3);
    }
    
    .status-badge.waiting {
      background-color: rgba(255, 193, 7, 0.1);
      color: var(--warning-color);
      border: 1px solid rgba(255, 193, 7, 0.3);
    }
    
    .status-badge.expired {
      background-color: rgba(255, 82, 82, 0.1);
      color: var(--danger-color);
      border: 1px solid rgba(255, 82, 82, 0.3);
    }
    
    /* Responsive adjustments for admin features */
    @media (max-width: 768px) {
      .quiz-form .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .admin-subject-selector {
        flex-direction: column;
      }
      
      .quiz-table {
        display: block;
        overflow-x: auto;
      }
      
      .admin-subject-card {
        min-width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-brand">
      <img src="/api/placeholder/40/40" alt="Allquiz Logo">
      <h1>Allquiz</h1>
    </div>
    <div class="navbar-menu">
      <a href="#" class="navbar-item active"><i class="fas fa-home"></i> <span>หน้าหลัก</span></a>
      <a href="#" class="navbar-item"><i class="fas fa-user-graduate"></i> <span>วิชาทั้งหมด</span></a>
      <a href="#" class="navbar-item"><i class="fas fa-info-circle"></i> <span>เกี่ยวกับเรา</span></a>
      <div class="navbar-item" id="notification-toggle" onclick="toggleNotificationCenter()">
        <i class="fas fa-bell"></i>
        <span class="notification-badge-count" id="notification-badge">0</span>
      </div>
      <div class="navbar-item" id="admin-toggle" onclick="showAdminLogin()">
        <i class="fas fa-lock"></i> <span>Admin</span>
        <span class="admin-indicator" id="admin-indicator">เข้าสู่ระบบแล้ว</span>
      </div>
    </div>
  </nav>

  <!-- Admin Login Modal -->
  <div class="admin-login-modal" id="admin-login-modal" style="display: none;">
    <div class="admin-login-container">
      <div class="admin-login-header">
        <h2>เข้าสู่ระบบผู้ดูแล</h2>
        <button class="admin-login-close" onclick="hideAdminLogin()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="admin-login-content">
        <form class="admin-login-form" id="admin-login-form">
          <div class="form-group">
            <label for="admin-username">ชื่อผู้ใช้</label>
            <input type="text" id="admin-username" placeholder="ชื่อผู้ใช้ผู้ดูแลระบบ" required>
          </div>
          <div class="form-group">
            <label for="admin-password">รหัสผ่าน</label>
            <input type="password" id="admin-password" placeholder="รหัสผ่าน" required>
          </div>
          <button type="submit" class="admin-login-button">
            <i class="fas fa-sign-in-alt"></i> เข้าสู่ระบบ
          </button>
          <div class="login-error" id="login-error">
            ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Toast Notifications Container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Quiz Edit/Add Modal -->
  <div class="quiz-modal" id="quiz-modal" style="display: none;">
    <div class="quiz-modal-container">
      <div class="quiz-modal-header">
        <h3 id="quiz-modal-title">เพิ่มควิซใหม่</h3>
        <button class="quiz-modal-close" onclick="hideQuizModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="quiz-modal-content">
        <form class="quiz-form" id="quiz-form">
          <input type="hidden" id="edit-quiz-id" value="">
          <input type="hidden" id="edit-subject" value="">
          
          <div class="form-group">
            <label for="quiz-name">ชื่อควิซ <span style="color: var(--danger-color);">*</span></label>
            <input type="text" id="quiz-name" placeholder="ชื่อควิซ" required>
          </div>
          
          <div class="form-group">
            <label for="quiz-link">ลิงก์เฉลย</label>
            <input type="url" id="quiz-link" placeholder="https://example.com/quiz-answers">
          </div>
          
          <div class="form-group">
            <label for="quiz-description">คำอธิบาย</label>
            <textarea id="quiz-description" placeholder="รายละเอียดเกี่ยวกับควิซนี้"></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="quiz-expiry">วันหมดอายุ</label>
              <input type="datetime-local" id="quiz-expiry">
            </div>
            
            <div class="form-group">
              <label for="quiz-status">สถานะ</label>
              <select id="quiz-status">
                <option value="">-- ไม่ระบุ --</option>
                <option value="อัพเดตล่าสุด">อัพเดตล่าสุด</option>
                <option value="รออัพเดต">รออัพเดต</option>
                <option value="ปิดปรับปรุง">ปิดปรับปรุง</option>
              </select>
            </div>
          </div>
          
          <button type="submit" class="quiz-save-button" id="quiz-save-button">
            <i class="fas fa-save"></i> บันทึก
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="confirm-modal" id="confirm-modal" style="display: none;">
    <div class="confirm-container">
      <div class="confirm-header">
        <h3>ยืนยันการลบ</h3>
      </div>
      <div class="confirm-content">
        <p id="confirm-message">คุณแน่ใจหรือไม่ว่าต้องการลบรายการนี้?</p>
        <div class="confirm-actions">
          <button class="confirm-button cancel" onclick="hideConfirmModal()">ยกเลิก</button>
          <button class="confirm-button confirm" id="confirm-delete-button">ลบ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Center -->
  <div id="notification-center">
    <div class="notification-header">
      <h3>การแจ้งเตือน</h3>
      <button class="notification-close" onclick="toggleNotificationCenter()"><i class="fas fa-times"></i></button>
    </div>
    <div class="notification-tabs">
      <div class="notification-tab active" data-tab="all">ทั้งหมด</div>
      <div class="notification-tab" data-tab="expiry">กำลังหมดเวลา</div>
      <div class="notification-tab" data-tab="update">อัพเดตล่าสุด</div>
    </div>
    <div class="notification-content" id="notification-content">
      <!-- Notification content will be loaded here by JS -->
    </div>
  </div>

  <!-- Admin Panel -->
  <div class="admin-panel" id="admin-panel">
    <div class="admin-header">
      <h2>ระบบจัดการควิซ</h2>
      <div class="admin-controls">
        <button class="admin-button" onclick="refreshQuizData()">
          <i class="fas fa-sync-alt"></i> รีเฟรช
        </button>
        <button class="admin-button danger" onclick="logoutAdmin()">
          <i class="fas fa-sign-out-alt"></i> ออกจากระบบ
        </button>
      </div>
    </div>
    <div class="admin-content">
      <h3>เลือกวิชาที่ต้องการจัดการ</h3>
      <div class="admin-subject-selector" id="admin-subject-selector">
        <!-- Subjects will be loaded here -->
      </div>
      
      <div class="quiz-editor" id="quiz-editor">
        <div class="quiz-editor-header">
          <h3 id="quiz-editor-subject">ควิซในวิชา</h3>
          <div class="quiz-editor-actions">
            <button class="quiz-editor-button add" onclick="showAddQuizModal()">
              <i class="fas fa-plus"></i> เพิ่มควิซใหม่
            </button>
          </div>
        </div>
        
        <table class="quiz-table">
          <thead>
            <tr>
              <th style="width: 30%">ชื่อควิซ</th>
              <th style="width: 20%">วันหมดอายุ</th>
              <th style="width: 15%">สถานะ</th>
              <th style="width: 20%">ลิงก์</th>
              <th style="width: 15%">การจัดการ</th>
            </tr>
          </thead>
          <tbody id="quiz-table-body">
            <!-- Quiz data will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Popup Announcement -->
  <div class="popup-overlay" id="popup-overlay">
    <div class="popup-content">
      <div class="popup-header">ธรรมชาติบำบัด- ประกาศสำคัญ</div>
      <span class="close-btn" id="close-popup">&times;</span>
      <h1>ข้อสอบปลายภาค 20 คะแนน <br> </h1>
      <p>
        นักศึกษามีสิทธิเข้าระบบเพื่อทำข้อสอบได้ครั้งเดียว ครั้งที่สองจะไม่มีสิทธิทำข้อสอบ<br>
      </p>
      <p class="update-time">Updated: 19 มีนาคม 2568</p>
      <button class="btn" id="start-redirect">เปิดทำข้อสอบ</button>
      <div class="popup-footer">© doralaikon | PSU</div>
    </div>
  </div>

  <!-- Main Container -->
  <div class="main-container">
    <section id="subjects">
      <h2 class="section-title">เลือกวิชา</h2>
      <div class="subject-list" id="subject-list"></div>
    </section>

    <section id="quiz-list" style="display: none;">
      <h2 class="section-title" id="subject-title">วิชา</h2>
      <div class="quiz-list" id="quiz-container"></div>
      <div class="back-button" id="back-button">
        <i class="fas fa-arrow-left"></i> ย้อนกลับ
      </div>
    </section>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>เกี่ยวกับเรา</h3>
        <p>Allquiz เป็นเว็บไซต์ที่ให้บริการเฉลยคำตอบในรายวิชาต่างๆ สำหรับนักศึกษาและผู้ที่ต้องการคำแนะนำในการศึกษา</p>
        <div class="social-icons">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-line"></i></a>
        </div>
      </div>
      <div class="footer-section">
        <h3>ลิงก์ด่วน</h3>
        <ul>
          <li><a href="#">หน้าหลัก</a></li>
          <li><a href="#">วิชาทั้งหมด</a></li>
          <li><a href="#">วิธีการใช้งาน</a></li>
          <li><a href="#">ติดต่อเรา</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>ติดต่อ</h3>
        <p><i class="fas fa-envelope"></i> info@allquiz.com</p>
        <p><i class="fas fa-phone"></i> 099-999-9999</p>
        <p><i class="fas fa-map-marker-alt"></i> มหาวิทยาลัยสงขลานครินทร์</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>© 2025 Doralaikon_TH Allquizes | สงวนลิขสิทธิ์</p>
    </div>
  </footer>

  <script>
    // Google Sheets API configuration
    const sheetId = "1-7p30j2PR8oLeyJ02vMq1ut5IZ6iSh8zvMFS50w74Lc";
    const sheetRange = "Allquestions";
    const apiKey = "AIzaSyB4AyLjp-qzWqGm9uoKBeF2G8XUwk-eWPw";

    // Admin credentials (In production, these should be stored securely on the server)
    const ADMIN_USERNAME = "admin";
    const ADMIN_PASSWORD = "allquiz2025";

    // Global variables
    let allSubjects = [];
    let allQuizzes = {};
    let selectedSubject = "";
    let editingQuizIndex = -1;
    let isAdminLoggedIn = false;
    
    // Global variables for notifications
    let allNotifications = [];
    let closeToExpiryQuizzes = [];
    let expiredQuizzes = [];
    let latestUpdates = [];
    let activeNotificationTab = 'all';

    // Initialize the application
    document.addEventListener("DOMContentLoaded", async () => {
      setupEventListeners();
      
      // Check for admin login in session storage
      checkAdminLoginStatus();
      
      // Initialize the website
      await initializeSubjects();
    });
    
    // Setup all event listeners
    function setupEventListeners() {
      // Admin login form submission
      document.getElementById("admin-login-form").addEventListener("submit", function(e) {
        e.preventDefault();
        attemptAdminLogin();
      });
      
      // Quiz form submission
      document.getElementById("quiz-form").addEventListener("submit", function(e) {
        e.preventDefault();
        saveQuiz();
      });
      
      // Back button for quiz list
      document.getElementById("back-button").addEventListener("click", goBack);
      
      // Popup close
      const popupOverlay = document.getElementById("popup-overlay");
      const closePopup = document.getElementById("close-popup");
      const startRedirect = document.getElementById("start-redirect");
      
      // ตั้งค่าเวลาตามเวลาประเทศไทย (UTC+7)
      const now = new Date();
      const bangkokOffset = 7 * 60 * 60 * 1000; // ชดเชย 7 ชั่วโมงเป็นมิลลิวินาที
      const bangkokTime = new Date(now.getTime() + bangkokOffset);

      // กำหนดช่วงเวลาเปิด Popup
      const startDate = new Date("2025-03-19T12:00:00+07:00");
      const endDate = new Date("2025-03-19T23:59:59+07:00");

      // แสดง Popup หากอยู่ในช่วงเวลา
      if (bangkokTime >= startDate && bangkokTime <= endDate) {
        popupOverlay.style.display = "flex";
      } else {
        popupOverlay.style.display = "none";
      }

      closePopup.addEventListener("click", () => {
        popupOverlay.style.display = "none";
      });

      startRedirect.addEventListener("click", () => {
        popupOverlay.style.display = "none";
        setTimeout(() => {
          window.location.href = "https://doralaikon.online/allquestions/course/ธรรมชาติบำบัด/ข้อสอบปลายภาคธรรมชาติบำบัด";
        }, 1000);
      });
      
      // Notification tabs
      const notificationTabs = document.querySelectorAll(".notification-tab");
      notificationTabs.forEach(tab => {
        tab.addEventListener("click", (e) => {
          const tabType = e.currentTarget.getAttribute('data-tab');
          switchNotificationTab(tabType);
        });
      });
      
      // Close notification when clicking outside
      document.addEventListener("click", (e) => {
        const notificationCenter = document.getElementById("notification-center");
        const notificationToggle = document.getElementById("notification-toggle");
        if (notificationCenter.classList.contains("active") && 
            !notificationCenter.contains(e.target) && 
            e.target !== notificationToggle && 
            !notificationToggle.contains(e.target)) {
          notificationCenter.classList.remove("active");
        }
      });
    }
    
    // Check if admin is logged in from session storage
    function checkAdminLoginStatus() {
      const storedLoginStatus = sessionStorage.getItem("adminLoggedIn");
      
      if (storedLoginStatus === "true") {
        isAdminLoggedIn = true;
        document.getElementById("admin-indicator").style.display = "inline-block";
        document.getElementById("admin-panel").style.display = "block";
      }
    }
    
    // Admin login attempt
    function attemptAdminLogin() {
      const username = document.getElementById("admin-username").value;
      const password = document.getElementById("admin-password").value;
      const loginError = document.getElementById("login-error");
      
      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        // Login successful
        isAdminLoggedIn = true;
        
        // Save login status to session storage (will be cleared when browser is closed)
        sessionStorage.setItem("adminLoggedIn", "true");
        
        // Show admin indicator in navbar
        document.getElementById("admin-indicator").style.display = "inline-block";
        
        // Show admin panel
        document.getElementById("admin-panel").style.display = "block";
        
        // Hide login modal
        hideAdminLogin();
        
        // Initialize admin subject selector
        initializeAdminSubjects();
        
        // Show success toast
        showToast("เข้าสู่ระบบสำเร็จ", "success");
      } else {
        // Login failed
        loginError.style.display = "block";
        
        // Clear password field
        document.getElementById("admin-password").value = "";
        
        // Focus on username field
        document.getElementById("admin-username").focus();
      }
    }
    
    // Admin logout
    function logoutAdmin() {
      isAdminLoggedIn = false;
      
      // Clear login status from session storage
      sessionStorage.removeItem("adminLoggedIn");
      
      // Hide admin indicator in navbar
      document.getElementById("admin-indicator").style.display = "none";
      
      // Hide admin panel
      document.getElementById("admin-panel").style.display = "none";
      
      // Reset form fields
      document.getElementById("admin-username").value = "";
      document.getElementById("admin-password").value = "";
      
      // Show success toast
      showToast("ออกจากระบบสำเร็จ", "info");
    }
    
    // Show admin login modal
    function showAdminLogin() {
      // If already logged in, show admin panel
      if (isAdminLoggedIn) {
        document.getElementById("admin-panel").style.display = "block";
        return;
      }
      
      document.getElementById("admin-login-modal").style.display = "flex";
      document.getElementById("login-error").style.display = "none";
      document.getElementById("admin-username").focus();
    }
    
    // Hide admin login modal
    function hideAdminLogin() {
      document.getElementById("admin-login-modal").style.display = "none";
    }
    
    // Initialize admin subject selector
    function initializeAdminSubjects() {
      const adminSubjectSelector = document.getElementById("admin-subject-selector");
      adminSubjectSelector.innerHTML = "";
      
      Object.keys(allQuizzes).forEach(subject => {
        const subjectCard = document.createElement('div');
        subjectCard.className = 'admin-subject-card';
        
        // Choose appropriate icon based on subject name
        let icon = 'fa-book';
        if (subject.toLowerCase().includes('คอมพิวเตอร์') || subject.toLowerCase().includes('computer')) {
          icon = 'fa-laptop-code';
        } else if (subject.toLowerCase().includes('คณิตศาสตร์') || subject.toLowerCase().includes('math')) {
          icon = 'fa-calculator';
        } else if (subject.toLowerCase().includes('วิทยาศาสตร์') || subject.toLowerCase().includes('science')) {
          icon = 'fa-flask';
        } else if (subject.toLowerCase().includes('ภาษา') || subject.toLowerCase().includes('language')) {
          icon = 'fa-language';
        }
        
        subjectCard.innerHTML = `
          <i class="fas ${icon}"></i>
          <h4>${subject}</h4>
        `;
        
        subjectCard.onclick = () => selectAdminSubject(subject);
        
        adminSubjectSelector.appendChild(subjectCard);
      });
    }
    
    // Select a subject in admin panel
    function selectAdminSubject(subject) {
      // Update UI
      const subjectCards = document.querySelectorAll('.admin-subject-card');
      subjectCards.forEach(card => {
        if (card.querySelector('h4').textContent === subject) {
          card.classList.add('active');
        } else {
          card.classList.remove('active');
        }
      });
      
      // Update selected subject
      selectedSubject = subject;
      
      // Update quiz editor header
      document.getElementById("quiz-editor-subject").textContent = `ควิซในวิชา ${subject}`;
      
      // Show quiz editor
      document.getElementById("quiz-editor").style.display = "block";
      
      // Populate quiz table
      populateQuizTable(subject);
    }
    
    // Populate quiz table with quizzes from selected subject
    function populateQuizTable(subject) {
      const quizzes = allQuizzes[subject] || [];
      const tableBody = document.getElementById("quiz-table-body");
      tableBody.innerHTML = "";
      
      if (quizzes.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 30px;">
              <i class="fas fa-info-circle" style="font-size: 2rem; color: #aaa; margin-bottom: 10px;"></i>
              <p>ยังไม่มีควิซในวิชานี้</p>
              <button class="quiz-editor-button add" onclick="showAddQuizModal()" style="margin-top: 15px; display: inline-block;">
                <i class="fas fa-plus"></i> เพิ่มควิซใหม่
              </button>
            </td>
          </tr>
        `;
        return;
      }
      
      quizzes.forEach((quiz, index) => {
        const row = document.createElement("tr");
        
        // Format expiry date
        let expiryDisplay = '';
        if (quiz.expiryDate) {
          const expiryStatus = calculateCountdown(quiz.expiryDate);
          if (expiryStatus === 'ควิซนี้หมดเขตแล้ว') {
            expiryDisplay = `<span class="status-badge expired">หมดเวลา</span><br>
                            <small style="color: #777;">${quiz.expiryDate}</small>`;
          } else {
            expiryDisplay = `<span class="status-badge active">ยังไม่หมดเวลา</span><br>
                            <small style="color: #777;">${quiz.expiryDate}</small>`;
          }
        } else {
          expiryDisplay = '<span style="color: #777;">ไม่ระบุ</span>';
        }
        
        // Format status
        let statusDisplay = '';
        if (quiz.status) {
          let statusClass = '';
          if (quiz.status.includes('อัพเดตล่าสุด')) {
            statusClass = 'active';
          } else if (quiz.status.includes('รออัพเดต') || quiz.status.includes('ปิดปรับปรุง')) {
            statusClass = 'waiting';
          }
          
          statusDisplay = `<span class="status-badge ${statusClass}">${quiz.status}</span>`;
        } else {
          statusDisplay = '<span style="color: #777;">ไม่ระบุ</span>';
        }
        
        // Format link
        let linkDisplay = '';
        if (quiz.quizLink) {
          linkDisplay = `<a href="${quiz.quizLink}" target="_blank" style="color: var(--primary-color); text-decoration: none;">
                          <i class="fas fa-external-link-alt"></i> ดูลิงก์
                         </a>`;
        } else {
          linkDisplay = '<span style="color: #777;">ไม่มีลิงก์</span>';
        }
        
        row.innerHTML = `
          <td>${quiz.quizName}</td>
          <td>${expiryDisplay}</td>
          <td>${statusDisplay}</td>
          <td>${linkDisplay}</td>
          <td>
            <div class="quiz-actions">
              <button class="quiz-action-button edit" onclick="showEditQuizModal(${index})">
                <i class="fas fa-edit"></i>
              </button>
              <button class="quiz-action-button delete" onclick="confirmDeleteQuiz(${index})">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        
        tableBody.appendChild(row);
      });
    }
    
    // Show the quiz modal for adding a new quiz
    function showAddQuizModal() {
      // Reset form
      document.getElementById("quiz-form").reset();
      document.getElementById("edit-quiz-id").value = "-1";
      document.getElementById("edit-subject").value = selectedSubject;
      
      // Update modal title
      document.getElementById("quiz-modal-title").textContent = "เพิ่มควิซใหม่";
      
      // Show modal
      document.getElementById("quiz-modal").style.display = "flex";
    }
    
    // Show the quiz modal for editing an existing quiz
    function showEditQuizModal(quizIndex) {
      // Set editing quiz index
      editingQuizIndex = quizIndex;
      
      // Get quiz data
      const quiz = allQuizzes[selectedSubject][quizIndex];
      
      // Set form values
      document.getElementById("edit-quiz-id").value = quizIndex;
      document.getElementById("edit-subject").value = selectedSubject;
      document.getElementById("quiz-name").value = quiz.quizName || "";
      document.getElementById("quiz-link").value = quiz.quizLink || "";
      document.getElementById("quiz-description").value = quiz.quizDescription || "";
      document.getElementById("quiz-status").value = quiz.status || "";
      
      // Format expiry date for datetime-local input
      if (quiz.expiryDate) {
        try {
          const [datePart, timePart] = quiz.expiryDate.split(", ");
          if (datePart) {
            const [day, month, year] = datePart.split("/");
            let formattedTime = timePart || "00:00";
            if (formattedTime.split(":").length === 3) {
              formattedTime = formattedTime.split(":").slice(0, 2).join(":");
            }
            
            const formattedDate = `${year}-${month.padStart(2, "0")}-${day.padStart(2, "0")}T${formattedTime}`;
            document.getElementById("quiz-expiry").value = formattedDate;
          }
        } catch (error) {
          console.error("Error formatting date:", error);
        }
      } else {
        document.getElementById("quiz-expiry").value = "";
      }
      
      // Update modal title
      document.getElementById("quiz-modal-title").textContent = "แก้ไขควิซ";
      
      // Show modal
      document.getElementById("quiz-modal").style.display = "flex";
    }
    
    // Hide the quiz modal
    function hideQuizModal() {
      document.getElementById("quiz-modal").style.display = "none";
    }
    
    // Save quiz (add new or update existing)
    async function saveQuiz() {
      // Get form values
      const quizIndex = document.getElementById("edit-quiz-id").value;
      const subject = document.getElementById("edit-subject").value;
      const quizName = document.getElementById("quiz-name").value;
      const quizLink = document.getElementById("quiz-link").value;
      const quizDescription = document.getElementById("quiz-description").value;
      const quizStatus = document.getElementById("quiz-status").value;
      
      // Format expiry date
      let expiryDate = "";
      const expiryInput = document.getElementById("quiz-expiry").value;
      if (expiryInput) {
        try {
          const [datePart, timePart] = expiryInput.split("T");
          const [year, month, day] = datePart.split("-");
          expiryDate = `${day}/${month}/${year}, ${timePart}`;
        } catch (error) {
          console.error("Error formatting date:", error);
        }
      }
      
      // Create or update quiz object
      const quizData = {
        quizName,
        quizLink,
        quizDescription,
        expiryDate,
        status: quizStatus
      };
      
      // Determine if this is an add or update operation
      const isAddOperation = quizIndex === "-1";
      
      if (isAddOperation) {
        // Add new quiz
        allQuizzes[subject].push(quizData);
        showToast("เพิ่มควิซใหม่สำเร็จ", "success");
      } else {
        // Update existing quiz
        allQuizzes[subject][parseInt(quizIndex)] = quizData;
        showToast("อัพเดตควิซสำเร็จ", "success");
      }
      
      // Save to Google Sheets (this is a mock implementation)
      await saveQuizToGoogleSheets();
      
      // Hide modal
      hideQuizModal();
      
      // Refresh quiz table
      populateQuizTable(subject);
      
      // Update the main website if already displayed
      if (document.getElementById('quiz-list').style.display !== 'none') {
        if (selectedSubject === subject) {
          showQuizzes(subject, allQuizzes[subject]);
        }
      }
    }
    
    // Confirm delete quiz
    function confirmDeleteQuiz(quizIndex) {
      // Set quiz index to delete
      editingQuizIndex = quizIndex;
      
      // Set confirm message
      const quizName = allQuizzes[selectedSubject][quizIndex].quizName;
      document.getElementById("confirm-message").textContent = `คุณแน่ใจหรือไม่ว่าต้องการลบควิซ "${quizName}"?`;
      
      // Set confirm button action
      document.getElementById("confirm-delete-button").onclick = deleteQuiz;
      
      // Show confirm modal
      document.getElementById("confirm-modal").style.display = "flex";
    }
    
    // Hide confirm modal
    function hideConfirmModal() {
      document.getElementById("confirm-modal").style.display = "none";
    }
    
    // Delete quiz
    async function deleteQuiz() {
      // Remove quiz from array
      allQuizzes[selectedSubject].splice(editingQuizIndex, 1);
      
      // Save to Google Sheets (this is a mock implementation)
      await saveQuizToGoogleSheets();
      
      // Hide confirm modal
      hideConfirmModal();
      
      // Refresh quiz table
      populateQuizTable(selectedSubject);
      
      // Show success toast
      showToast("ลบควิซสำเร็จ", "success");
      
      // Update the main website if already displayed
      if (document.getElementById('quiz-list').style.display !== 'none') {
        if (selectedSubject === selectedSubject) {
          showQuizzes(selectedSubject, allQuizzes[selectedSubject]);
        }
      }
    }
    
    // Save quiz data to Google Sheets (mock implementation)
    async function saveQuizToGoogleSheets() {
      // In a real application, this would send the data to a server-side script
      // that would update the Google Sheet.
      // For this example, we'll just show a message.
      
      console.log("Quiz data saved (mock):", allQuizzes);
      
      // Simulate API delay
      return new Promise(resolve => setTimeout(resolve, 500));
    }
    
    // Refresh quiz data from Google Sheets
    async function refreshQuizData() {
      showToast("กำลังโหลดข้อมูล...", "info");
      await initializeSubjects();
      
      if (selectedSubject) {
        populateQuizTable(selectedSubject);
      }
      
      showToast("โหลดข้อมูลสำเร็จ", "success");
    }
    
    // Show toast notification
    function showToast(message, type = "info") {
      const toastContainer = document.getElementById("toast-container");
      
      const toast = document.createElement("div");
      toast.className = `toast ${type}`;
      
      let icon = "fa-info-circle";
      if (type === "success") {
        icon = "fa-check-circle";
      } else if (type === "error") {
        icon = "fa-exclamation-circle";
      }
      
      toast.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
      
      toastContainer.appendChild(toast);
      
      // Remove toast after 3 seconds
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // ดึงข้อมูลจาก Google Sheets
    async function fetchSubjects() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetRange}?key=${apiKey}`;
      try {
        const response = await fetch(url);
        const data = await response.json();
        if (data.values) {
          return data.values;
        } else {
          console.error("ไม่พบข้อมูลใน Google Sheets");
          return [];
        }
      } catch (error) {
        console.error("เกิดข้อผิดพลาดในการดึงข้อมูล:", error);
        return [];
      }
    }

    // แปลงรูปแบบวันที่
    function parseExpiryDate(expiryDate) {
      if (!expiryDate || expiryDate.trim() === '') return null;

      const dateFormats = [
        { regex: /^(\d{1,2})\/(\d{1,2})\/(\d{4}),\s*(\d{1,2}):(\d{2}):(\d{2})$/, parse: (d, m, y, h, min, sec) => `${y}-${m.padStart(2, '0')}-${d.padStart(2, '0')}T${h.padStart(2, '0')}:${min}:${sec}` },
        { regex: /^(\d{1,2})\/(\d{1,2})\/(\d{4}),\s*(\d{1,2}):(\d{2})$/, parse: (d, m, y, h, min) => `${y}-${m.padStart(2, '0')}-${d.padStart(2, '0')}T${h.padStart(2, '0')}:${min}:00` },
        { regex: /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/, parse: (d, m, y) => `${y}-${m.padStart(2, '0')}-${d.padStart(2, '0')}T00:00:00` },
        { regex: /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})$/, parse: (y, m, d, h, min, sec) => `${y}-${m}-${d}T${h}:${min}:${sec}` },
      ];

      for (const { regex, parse } of dateFormats) {
        const match = expiryDate.match(regex);
        if (match) {
          const formattedDate = parse(...match.slice(1));
          return new Date(formattedDate).getTime();
        }
      }

      return null;
    }

    // คำนวณเวลา countdown แบบปรับปรุง
    function calculateCountdown(expiryDate) {
      if (!expiryDate || expiryDate.trim() === '') return '';

      try {
        const [date, time] = expiryDate.split(", ");
        const [day, month, year] = date.split("/");

        // ตรวจสอบว่าเป็นปีปัจจุบันหรือปีถัดไป
        const now = new Date();
        let expiryYear = parseInt(year, 10);

        // ตรวจสอบว่าเป็นปีที่แล้วหรือไม่
        if (expiryYear < now.getFullYear()) {
          return 'ควิซนี้หมดเขตแล้ว';
        }

        // แปลงวันที่ให้เป็น ISO 8601
        const formattedDate = `${expiryYear}-${month.padStart(2, '0')}-${day.padStart(2, '0')}T${time || "00:00:00"}+07:00`;

        const endDate = new Date(formattedDate);
        const timeLeft = endDate.getTime() - now.getTime();

        if (timeLeft <= 0) return 'ควิซนี้หมดเขตแล้ว';

        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        
        // สร้างรูปแบบการแสดงผลที่ดีขึ้น
        let timeString = '';
        
        if (days > 0) {
          timeString += `${days} วัน `;
          if (hours > 0) timeString += `${hours} ชม.`;
          return timeString.trim();
        }
        
        if (hours > 0) {
          timeString += `${hours} ชม. `;
          if (minutes > 0) timeString += `${minutes} นาที`;
          return timeString.trim();
        }
        
        if (minutes > 0) {
          timeString += `${minutes} นาที `;
          if (seconds > 0) timeString += `${seconds} วินาที`;
          return timeString.trim();
        }
        
        return `${seconds} วินาที`;
      } catch (error) {
        console.error("Error calculating countdown:", error);
        return '';
      }
    }

    // อัปเดต countdown ทุกวินาที
    function updateCountdowns() {
      document.querySelectorAll('.countdown').forEach(el => {
        const expiryDate = el.getAttribute('data-expiry');
        if (!expiryDate) return;

        const countdown = calculateCountdown(expiryDate);

        if (countdown === 'ควิซนี้หมดเขตแล้ว') {
          el.className = 'status expired';
          el.innerText = countdown;
        } else {
          el.className = 'countdown';
          el.innerHTML = `<i class="fas fa-clock"></i> ${countdown}`;
        }
      });
    }

    // เปิด/ปิด Notification Center
    function toggleNotificationCenter() {
      const notificationCenter = document.getElementById('notification-center');
      notificationCenter.classList.toggle('active');
      
      // Animation for bell icon
      const bellIcon = document.querySelector('#notification-toggle i');
      bellIcon.classList.add('bell-ring');
      setTimeout(() => {
        bellIcon.classList.remove('bell-ring');
      }, 1000);
    }

    // สลับแท็บ notification
    function switchNotificationTab(tab) {
      activeNotificationTab = tab;
      
      // Update active tab highlighting
      document.querySelectorAll('.notification-tab').forEach(el => {
        el.classList.remove('active');
      });
      
      // Find and add active class to the clicked tab
      document.querySelector(`.notification-tab[data-tab="${tab}"]`).classList.add('active');
      
      // Update content based on selected tab
      updateNotificationContent();
    }

    // อัปเดตเนื้อหาการแจ้งเตือนตามแท็บที่เลือก
    function updateNotificationContent() {
      const notificationContent = document.getElementById('notification-content');
      let notifications = [];
      
      switch (activeNotificationTab) {
        case 'expiry':
          notifications = [...closeToExpiryQuizzes, ...expiredQuizzes];
          break;
        case 'update':
          notifications = latestUpdates;
          break;
        default: // 'all'
          notifications = allNotifications;
          break;
      }
      
      if (notifications.length === 0) {
        notificationContent.innerHTML = `
          <div class="no-notifications">
            <i class="far fa-bell-slash"></i>
            <p>ไม่มีการแจ้งเตือนใน${activeNotificationTab === 'all' ? 'ขณะนี้' : 'หมวดนี้'}</p>
          </div>
        `;
        return;
      }
      
      let html = '';
      
      // Group notifications by type for 'all' tab
      if (activeNotificationTab === 'all') {
        // Show expiring quizzes first
        if (closeToExpiryQuizzes.length > 0) {
          html += `
            <div class="notification-section">
              <h4 class="notification-section-title">
                <i class="fas fa-clock"></i> ควิซที่กำลังจะหมดเวลา
              </h4>
              <ul class="notification-list">
          `;
          
          closeToExpiryQuizzes.forEach(notification => {
            html += createNotificationItemHTML(notification, 'expiry');
          });
          
          html += `</ul></div>`;
        }
        
        // Show expired quizzes
        if (expiredQuizzes.length > 0) {
          html += `
            <div class="notification-section">
              <h4 class="notification-section-title">
                <i class="fas fa-exclamation-circle"></i> ควิซที่หมดเวลาแล้ว
              </h4>
              <ul class="notification-list">
          `;
          
          expiredQuizzes.forEach(notification => {
            html += createNotificationItemHTML(notification, 'expiry');
          });
          
          html += `</ul></div>`;
        }
        
        // Show latest updates
        if (latestUpdates.length > 0) {
          html += `
            <div class="notification-section">
              <h4 class="notification-section-title">
                <i class="fas fa-sync-alt"></i> อัพเดตล่าสุด
              </h4>
              <ul class="notification-list">
          `;
          
          latestUpdates.forEach(notification => {
            html += createNotificationItemHTML(notification, 'update');
          });
          
          html += `</ul></div>`;
        }
      } else {
        // For specific tabs, just show a list
        html += `<ul class="notification-list">`;
        notifications.forEach(notification => {
          html += createNotificationItemHTML(
            notification, 
            activeNotificationTab === 'expiry' ? 'expiry' : 'update'
          );
        });
        html += `</ul>`;
      }
      
      notificationContent.innerHTML = html;
    }

    // Helper function to create HTML for a notification item
    function createNotificationItemHTML(notification, type) {
      const isExpiry = type === 'expiry';
      
      return `
        <li class="notification-item ${type}">
          <div class="notification-title">
            <i class="fas ${isExpiry ? 'fa-exclamation-circle' : 'fa-check-circle'} notification-icon"></i>
            ${notification.quizName}
          </div>
          <div class="notification-desc">
            วิชา: ${notification.subject}
            ${notification.timeLeftInHours ? `<br>เหลือเวลา: <strong>${notification.timeLeftInHours} ชั่วโมง</strong>` : ''}
            ${notification.isExpired ? '<br><strong>หมดเวลาแล้ว</strong>' : ''}
          </div>
          <a href="${notification.quizLink}" target="_blank" class="notification-link">
            ดูรายละเอียด <i class="fas fa-external-link-alt"></i>
          </a>
        </li>
      `;
    }

    // เตรียมข้อมูลการแจ้งเตือน
    function prepareNotifications(subjects) {
      closeToExpiryQuizzes = [];
      expiredQuizzes = [];
      latestUpdates = [];
      
      subjects.forEach((row, index) => {
        if (index === 0) return; // ข้ามหัวตาราง
        
        const [subject, quizName, quizLink, quizDescription, expiryDate, status] = row || [];
        
        if (!subject || !quizName) return;
        
        // Check for expiry notifications
        if (expiryDate) {
          try {
            const now = new Date().getTime();
            const endDate = parseExpiryDate(expiryDate);
            
            if (endDate) {
              const timeLeftInMilliseconds = endDate - now;
              const timeLeftInHours = timeLeftInMilliseconds / (1000 * 60 * 60);
              
              if (timeLeftInHours > 0 && timeLeftInHours <= 24) {
                closeToExpiryQuizzes.push({
                  subject,
                  quizName,
                  quizLink,
                  timeLeftInHours: Math.ceil(timeLeftInHours)
                });
              } else if (timeLeftInHours <= 0) {
                const timePassedInMilliseconds = now - endDate;
                const timePassedInDays = timePassedInMilliseconds / (1000 * 60 * 60 * 24);
                
                if (timePassedInDays <= 1) {
                  expiredQuizzes.push({
                    subject,
                    quizName,
                    quizLink,
                    isExpired: true
                  });
                }
              }
            }
          } catch (error) {
            console.warn(`Error parsing expiry date for quiz: ${quizName}`, error);
          }
        }
        
        // Check for latest updates
        if (status && status.toLowerCase().includes("อัพเดตล่าสุด")) {
          latestUpdates.push({
            subject,
            quizName,
            quizLink,
            updateStatus: status
          });
        }
      });
      
      // Combine all notifications
      allNotifications = [...closeToExpiryQuizzes, ...expiredQuizzes, ...latestUpdates];
      
      // Update notification badge
      const notificationBadge = document.getElementById('notification-badge');
      if (allNotifications.length > 0) {
        notificationBadge.innerText = allNotifications.length;
        notificationBadge.style.display = 'flex';
      } else {
        notificationBadge.style.display = 'none';
      }
      
      // Update notification content
      updateNotificationContent();
    }

    // สร้างการ์ดรายวิชา
    async function initializeSubjects() {
      const subjects = await fetchSubjects();
      const subjectList = document.getElementById('subject-list');
      allQuizzes = {};
      
      // สร้างโครงสร้างข้อมูลรายวิชา
      subjects.forEach((row, index) => {
        if (index === 0) return; // ข้ามหัวตาราง
        
        const [subject, quizName, quizLink, quizDescription, expiryDate, status] = row || [];
        
        if (subject && subject.trim() !== "") {
          if (!allQuizzes[subject]) {
            allQuizzes[subject] = [];
          }
          
          if (quizName) {
            allQuizzes[subject].push({
              quizName,
              quizLink,
              quizDescription,
              expiryDate,
              status
            });
          }
        }
      });
      
      // เตรียมข้อมูลการแจ้งเตือน
      prepareNotifications(subjects);
      
      // ถ้าผู้ดูแลเข้าสู่ระบบแล้ว อัปเดตส่วนของผู้ดูแล
      if (isAdminLoggedIn) {
        initializeAdminSubjects();
        
        // ถ้ามีวิชาที่เลือกอยู่แล้ว ให้โหลดข้อมูลควิซใหม่
        if (selectedSubject && allQuizzes[selectedSubject]) {
          selectAdminSubject(selectedSubject);
        }
      }
      
      // แสดงการ์ดรายวิชา
      subjectList.innerHTML = "";
      Object.keys(allQuizzes).forEach(subject => {
        const quizzes = allQuizzes[subject];
        const subjectCard = document.createElement('div');
        subjectCard.className = 'subject-card';
        
        // เลือกไอคอนที่เหมาะสมตามชื่อวิชา
        let icon = 'fa-book';
        if (subject.toLowerCase().includes('คอมพิวเตอร์') || subject.toLowerCase().includes('computer')) {
          icon = 'fa-laptop-code';
        } else if (subject.toLowerCase().includes('คณิตศาสตร์') || subject.toLowerCase().includes('math')) {
          icon = 'fa-calculator';
        } else if (subject.toLowerCase().includes('วิทยาศาสตร์') || subject.toLowerCase().includes('science')) {
          icon = 'fa-flask';
        } else if (subject.toLowerCase().includes('ภาษา') || subject.toLowerCase().includes('language')) {
          icon = 'fa-language';
        }
        
        subjectCard.innerHTML = `
          <i class="fas ${icon}"></i>
          <strong>${subject}</strong>
        `;
        
        if (quizzes.every(quiz => !quiz.quizName)) {
          subjectCard.innerHTML += `<div class="waiting-for-update">รออัพเดต</div>`;
        } else {
          // นับจำนวนควิซที่มี
          const availableQuizzes = quizzes.filter(quiz => quiz.quizName && quiz.quizLink).length;
          if (availableQuizzes > 0) {
            subjectCard.innerHTML += `<div class="quiz-count">${availableQuizzes} ควิซ</div>`;
          }
          
          subjectCard.onclick = () => showQuizzes(subject, quizzes);
        }
        
        subjectList.appendChild(subjectCard);
      });
    }

    // แสดงควิซในรายวิชาที่เลือก
    function showQuizzes(subject, quizzes) {
      document.getElementById('subjects').style.display = 'none';
      document.getElementById('quiz-list').style.display = 'block';
      document.getElementById('subject-title').innerText = `ควิซในวิชา ${subject}`;
      
      // Update selected subject for admin panel link
      selectedSubject = subject;
      
      const quizContainer = document.getElementById('quiz-container');
      quizContainer.innerHTML = '';
      
      quizzes.forEach(({ quizName, quizLink, quizDescription, expiryDate, status }, index) => {
        if (!quizName) return; // ข้ามควิซที่ไม่มีชื่อ
        
        const quizCard = document.createElement('div');
        quizCard.className = 'quiz-card';
        
        // เลือกไอคอนตามสถานะ
        let icon = 'fa-file-alt';
        if (status && status.toLowerCase().includes('อัพเดตล่าสุด')) {
          icon = 'fa-sync-alt';
        } else if (expiryDate && calculateCountdown(expiryDate) === 'ควิซนี้หมดเขตแล้ว') {
          icon = 'fa-hourglass-end';
        } else if (expiryDate) {
          icon = 'fa-hourglass-half';
        }
        
        quizCard.innerHTML = `
          <i class="fas ${icon}"></i>
          <strong>${quizName}</strong>
        `;
        
        if (quizDescription) {
          const description = document.createElement('div');
          description.className = 'quiz-description';
          description.innerHTML = `<strong>คำอธิบาย:</strong><br> ${quizDescription}`;
          description.style.whiteSpace = 'pre-line';
          quizCard.appendChild(description);
        }
        
        // แสดงสถานะถ้ามี
        if (status) {
          const statusElement = document.createElement('div');
          statusElement.className = 'status';
          
          if (status.toLowerCase().includes('อัพเดตล่าสุด')) {
            statusElement.classList.add('success');
          } else if (status.toLowerCase().includes('รออัพเดต') || status.toLowerCase().includes('ปิดปรับปรุง')) {
            statusElement.classList.add('waiting-for-update');
          }
          
          statusElement.innerText = status;
          quizCard.appendChild(statusElement);
        } 
        // แสดงเวลาถ้ามี expiryDate
        else if (expiryDate) {
          const countdown = document.createElement('div');
          countdown.className = 'countdown';
          countdown.setAttribute('data-expiry', expiryDate);
          quizCard.appendChild(countdown);
        }
        
        // เพิ่มปุ่มดูเฉลยถ้ามีลิงก์
        if (quizLink) {
          const answerButton = document.createElement('a');
          answerButton.className = 'answer-button';
          answerButton.href = quizLink;
          answerButton.target = '_blank';
          answerButton.innerHTML = `<i class="fas fa-external-link-alt"></i> ดูเฉลย`;
          quizCard.appendChild(answerButton);
        } else {
          // แสดง "รออัพเดต" ถ้าไม่มีลิงก์
          const waitingUpdate = document.createElement('div');
          waitingUpdate.className = 'waiting-for-update';
          waitingUpdate.innerText = 'รออัพเดต';
          quizCard.appendChild(waitingUpdate);
        }
        
        // Add edit button for admins
        if (isAdminLoggedIn) {
          const adminActions = document.createElement('div');
          adminActions.className = 'quiz-actions';
          adminActions.style.marginTop = '10px';
          
          const editButton = document.createElement('button');
          editButton.className = 'quiz-action-button edit';
          editButton.innerHTML = '<i class="fas fa-edit"></i>';
          editButton.title = 'แก้ไขควิซ';
          editButton.onclick = (e) => {
            e.stopPropagation();
            showEditQuizModal(index);
          };
          
          adminActions.appendChild(editButton);
          quizCard.appendChild(adminActions);
        }
        
        quizContainer.appendChild(quizCard);
      });
      
      updateCountdowns();
    }

    // กลับไปยังหน้ารายวิชา
    function goBack() {
      document.getElementById('quiz-list').style.display = 'none';
      document.getElementById('subjects').style.display = 'block';
    }
    
    // อัปเดต countdown ทุกวินาที
    setInterval(updateCountdowns, 1000);
  </script>
</body>
</html>
